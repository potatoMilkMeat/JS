<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>worker</title>
  <style>
  *{margin: 0;padding: 0;}
  h2,h3,h4,p{line-height: 1;padding-top: 15px; padding-bottom: 15px;padding-left:5px;}
  p{padding-left:2em;padding-top: 5px; padding-bottom: 5px; }
  button{width: 640px; height: 140px;text-align: center;line-height: 100px;font-size: 50px;border-width: 20px;}
  div{font-size: 14px;font-weight: normal; display: inline-block;padding-left: 10px;}
  </style>
</head>
<body>
  <h2>worker 独立线程 <div id="timer"></div></h2>
  <hr>
  <h3>    特点： 处理超过100ms 以上的任务；与界面UI无关的</h3>
  <hr>
  <h3>    具体用途：</h3>
  <p>    编码/解码大字符串；</p>
  <p>    复杂数学运算（包括图像和视频处理）；</p>
  <p>    大数组排序。</p>
  <hr>
  <h3>    其他特点：</h3>
  <p>    程序位于独立的js文件中；</p>
  <p>    阻塞式调用其他js文件, importScripts(url_String, ...)</p>
  <p>    所有的 ECMAScript对象，Object, Array, Date等；</p>
  <p>    支持XMLHttpRequest；</p>
  <p>    支持定时器；</p>
  <p>    一个close()方法，它能立即停止运行。</p>
  <button onclick="btnClick(event)">点击 换颜色</button>
  
<script>
  // 生成16进制
  function f16(){
    return Math.floor(Math.random() * 256).toString(16);
  }
  // 改变颜色
  function btnClick(event){
    var target = event.target;
    target.style.backgroundColor = '#'+f16()+f16()+f16();
  };
  // 时间格式化
  Date.prototype.Format = function(fmt){ //author: meizz   
    var o = {   
      "M+" : this.getMonth()+1,                 //月份   
      "d+" : this.getDate(),                    //日   
      "h+" : this.getHours(),                   //小时   
      "m+" : this.getMinutes(),                 //分   
      "s+" : this.getSeconds(),                 //秒   
      "q+" : Math.floor((this.getMonth()+3)/3), //季度   
      "S"  : this.getMilliseconds()             //毫秒   
    };   
    if(/(y+)/.test(fmt))   
      fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));   
    for(var k in o)   
      if(new RegExp("("+ k +")").test(fmt))   
    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
    return fmt;   
  }
  // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423   

  // 显示时间
  function setTimer_div(val){
    var div = document.getElementById('timer');
    if(!(val instanceof Date)){
      val = new Date(val);
    }
    val = val.Format("yyyy-MM-dd hh:mm:ss.S");
    div.innerHTML = val;
  };

  /* =======解析字符串========================================== */
  // 根据独立文件 code.js 创建Worker 实例
  var jsonParse = new Worker('JsonParse.js');

  // 处理回传的结果
  jsonParse.onmessage = function(event){
    var jsonData = event.data; // 获取回传的结果
    if(jsonData.type === 'timer'){
      console.log(jsonData);
      setTimer_div(jsonData.time);
      return;
    }
    var msg = jsonData.length || jsonData;
    console.log('==page== jsonParse 完成', +new Date(), msg); // 打印
  }
  // jsonParse.terminate(); // 关闭线程

  /* =======创建字符串========================================== */
  var jsonCreateStr = new Worker('./jsonCreateStr.js');

  jsonCreateStr.onmessage = function(event){
    var str = event.data;
    console.log('==page== jsonCreateStr 完成', +new Date(), str.length); // 打印
    jsonParse.postMessage({str: str, time: +new Date()}); // 传入要解析的大段JSON字符串
  }

  jsonCreateStr.postMessage({str:'--- jsonCreateStr开始--', time: +new Date() }); // jsonCreateStr 开始运行
</script>
</body>
</html>